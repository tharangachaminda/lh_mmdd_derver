<div class="question-generator">
  <!-- Header -->
  <div class="generator-header">
    <button class="back-btn" (click)="returnToDashboard()">← Back to Dashboard</button>
    <h1>AI Question Generator</h1>
    <p>Get personalized questions designed just for you!</p>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="error">
    <span>⚠️ {{ error }}</span>
    <button (click)="error = null">×</button>
  </div>

  <!-- Step 1: Question Setup -->
  <div class="setup-step" *ngIf="currentStep === 'setup'">
    <div class="step-header">
      <h2>📚 Let's Set Up Your Questions</h2>
      <p>Choose what you'd like to practice today</p>
    </div>

    <div class="setup-form">
      <div class="form-group">
        <label for="subject">Subject *</label>
        <select
          id="subject"
          [(ngModel)]="selectedSubject"
          (change)="onSubjectChange()"
          class="form-select"
        >
          <option value="">Select a subject...</option>
          <option *ngFor="let subject of subjects" [value]="subject">
            {{ subject | titlecase }}
          </option>
        </select>
      </div>

      <div class="form-group" *ngIf="availableTopics.length > 0">
        <label for="topic">Topic *</label>
        <select id="topic" [(ngModel)]="selectedTopic" class="form-select">
          <option value="">Select a topic...</option>
          <option *ngFor="let topic of availableTopics" [value]="topic">
            {{ topic }}
          </option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="difficulty">Difficulty Level</label>
          <select id="difficulty" [(ngModel)]="selectedDifficulty" class="form-select">
            <option *ngFor="let level of difficultyLevels" [value]="level">
              {{ level | titlecase }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="questionType">Question Type</label>
          <select id="questionType" [(ngModel)]="selectedQuestionType" class="form-select">
            <option *ngFor="let type of questionTypes" [value]="type">
              {{ type.replace('_', ' ') | titlecase }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="count">Number of Questions</label>
        <input
          type="number"
          id="count"
          [(ngModel)]="questionCount"
          min="1"
          max="10"
          class="form-input"
        />
      </div>

      <button
        class="proceed-btn"
        (click)="proceedToPersona()"
        [disabled]="!selectedSubject || !selectedTopic"
      >
        Next: Personalize Questions →
      </button>
    </div>
  </div>

  <!-- Step 2: Persona Setup -->
  <div class="persona-step" *ngIf="currentStep === 'persona'">
    <div class="step-header">
      <h2>🎯 Personalize Your Experience</h2>
      <p>Help us create questions that match your learning style and interests</p>
    </div>

    <div class="persona-form">
      <div class="form-group">
        <label>How do you learn best?</label>
        <div class="learning-styles">
          <div
            class="style-option"
            *ngFor="let style of learningStyles"
            [class.selected]="learningStyle === style"
            (click)="learningStyle = style"
          >
            <div class="style-icon">
              <span *ngIf="style === 'visual'">👁️</span>
              <span *ngIf="style === 'auditory'">👂</span>
              <span *ngIf="style === 'kinesthetic'">🤲</span>
              <span *ngIf="style === 'reading_writing'">📝</span>
            </div>
            <span>{{ style.replace('_', ' ') | titlecase }}</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>What are you interested in? (Select up to 5)</label>
        <div class="interests-grid">
          <div
            class="interest-tag"
            *ngFor="let interest of availableInterests"
            [class.selected]="interests.includes(interest)"
            [class.disabled]="!interests.includes(interest) && interests.length >= 5"
            (click)="toggleInterest(interest)"
          >
            {{ interest }}
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>What motivates you to learn? (Select up to 3)</label>
        <div class="motivators-grid">
          <div
            class="motivator-tag"
            *ngFor="let motivator of availableMotivators"
            [class.selected]="motivationalFactors.includes(motivator)"
            [class.disabled]="
              !motivationalFactors.includes(motivator) && motivationalFactors.length >= 3
            "
            (click)="toggleMotivator(motivator)"
          >
            {{ motivator }}
          </div>
        </div>
      </div>

      <div class="persona-actions">
        <button class="back-btn" (click)="currentStep = 'setup'">← Back</button>
        <button
          class="generate-btn"
          (click)="generateQuestions()"
          [disabled]="interests.length === 0"
        >
          🤖 Generate My Questions
        </button>
      </div>
    </div>
  </div>

  <!-- Step 3: Generating Questions -->
  <div class="generating-step" *ngIf="currentStep === 'generating'">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <h2>🤖 Creating Your Personalized Questions...</h2>
      <p>Our AI is analyzing your preferences and generating questions just for you!</p>
      <div class="loading-facts">
        <p>💡 Did you know? Personalized questions can improve learning by up to 40%!</p>
      </div>
    </div>
  </div>

  <!-- Step 4: Question Interface -->
  <div class="questions-step" *ngIf="currentStep === 'questions' && currentQuestion">
    <div class="question-progress">
      <div class="progress-bar">
        <div
          class="progress-fill"
          [style.width.%]="
            ((currentQuestionIndex + 1) / (currentSession?.questions?.length || 1)) * 100
          "
        ></div>
      </div>
      <span class="progress-text">
        Question {{ currentQuestionIndex + 1 }} of {{ currentSession?.questions?.length || 0 }}
      </span>
    </div>

    <div class="question-card">
      <div class="question-header">
        <span class="question-topic">{{ selectedSubject | titlecase }} - {{ selectedTopic }}</span>
        <span class="question-difficulty">{{ selectedDifficulty | titlecase }}</span>
      </div>

      <div class="question-content">
        <h3>{{ currentQuestion.question }}</h3>

        <!-- Multiple Choice Options -->
        <div class="question-options" *ngIf="currentQuestion.questionType === 'multiple_choice'">
          <div
            class="option"
            *ngFor="let option of currentQuestion.options; let i = index"
            [class.selected]="userAnswer === option"
            (click)="userAnswer = option"
          >
            <span class="option-letter">{{ getOptionLetter(i) }}</span>
            <span class="option-text">{{ option }}</span>
          </div>
        </div>

        <!-- Text Answer Input -->
        <div class="answer-input" *ngIf="currentQuestion.questionType !== 'multiple_choice'">
          <textarea
            [(ngModel)]="userAnswer"
            placeholder="Type your answer here..."
            class="answer-textarea"
          >
          </textarea>
        </div>
      </div>

      <div class="question-actions">
        <button
          class="hint-btn"
          (click)="showQuestionHint()"
          [disabled]="showHint || currentQuestion.hints.length === 0"
          *ngIf="currentQuestion.hints.length > 0"
        >
          💡 Get Hint ({{ hintsUsed }}/{{ currentQuestion.hints.length }})
        </button>

        <button
          class="submit-btn"
          (click)="submitAnswer()"
          [disabled]="!userAnswer.trim() || loading"
        >
          {{ loading ? 'Submitting...' : 'Submit Answer' }}
        </button>
      </div>

      <!-- Hint Display -->
      <div class="hint-display" *ngIf="showHint && currentQuestion.hints.length > 0">
        <h4>💡 Hint:</h4>
        <p>{{ currentQuestion.hints[hintsUsed - 1] }}</p>
      </div>
    </div>
  </div>

  <!-- Step 5: Results -->
  <div class="results-step" *ngIf="currentStep === 'results' && sessionResults">
    <div class="results-container">
      <div class="results-header">
        <h2>🎉 Great Job!</h2>
        <p>Here's how you did on your personalized questions</p>
      </div>

      <div class="score-display">
        <div class="score-circle">
          <span class="score-percentage">{{ sessionResults.percentage }}%</span>
        </div>
        <div class="score-details">
          <p>
            <strong>{{ sessionResults.score }}</strong> out of
            <strong>{{ sessionResults.maxScore }}</strong> correct
          </p>
          <p>
            Time spent: <strong>{{ sessionResults.timeSpent }}</strong> minutes
          </p>
        </div>
      </div>

      <div class="results-actions">
        <button class="new-session-btn" (click)="startNewSession()">🔄 Try More Questions</button>
        <button class="dashboard-btn" (click)="returnToDashboard()">📊 Back to Dashboard</button>
      </div>
    </div>
  </div>
</div>
